{% load static %}
{% load crispy_forms_tags %}
<!DOCTYPE html>
<html class="loading" lang="pt-br" data-textdirection="ltr">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
    <meta name="description" content="Vuexy admin is super flexible, powerful, clean &amp; modern responsive bootstrap 4 admin template with unlimited possibilities.">
    <meta name="keywords" content="admin template, Vuexy admin template, dashboard template, flat admin template, responsive admin template, web app">
    <title>ForAll&nbsp;Olá&nbsp;{{user.get_username}}</title>
    <link rel="shortcut icon" href="{% static '../static//img/forall.png' %}" type="image/x-icon">
    <link href="https://fonts.googleapis.com/css?family=Montserrat:300,400,500,600" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="{% static 'css/vertical-menu.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'css/vendors.min.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'css/bootstrap.min.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'css/bootstrap-extended.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'css/colors.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'css/components.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'css/dark-layout.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'css/semi-dark-layout.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'css/horizontal-menu.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'css/palette-gradient.min.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'css/users.css' %}">
    <style type="text/css">
        .sala{font-family: Times New Roman;color: white;margin: 0px;}
        #enviarSala{color: white;}
    </style>
</head>
<body class="horizontal-layout horizontal-menu dark-layout 2-columns  navbar-floating footer-static  " data-open="hover" data-menu="horizontal-menu" data-col="2-columns" data-layout="dark-layout">
    <nav class="header-navbar navbar-expand-lg navbar navbar-with-menu navbar-fixed navbar-shadow navbar-brand-center">
        <div class="navbar-wrapper">
            <div class="navbar-container content">
                <div class="navbar-collapse" id="navbar-mobile">
                    <div class="mr-auto float-left bookmark-wrapper d-flex align-items-center">
                        <ul class="nav navbar-nav">
                            <li class="nav-item mobile-menu d-xl-none mr-auto"><a class="nav-link nav-menu-main menu-toggle hidden-xs" href="#"><i class="ficon fa fa-align-justify"></i></a></li>
                        </ul>
                        <ul class="nav navbar-nav"> 
                            <div class="bookmark-input search-input">
                                <div class="bookmark-input-icon"><i class="feather icon-search primary"></i></div>
                                <input class="form-control input" type="text" placeholder="Explore Vuexy..." tabindex="0" data-search="template-list">
                                <ul class="search-list search-list-bookmark"></ul>
                            </div>
                        </li>
                    </ul>
                </div>
                <ul class="nav navbar-nav float-right">
                    <li class="nav-item d-none d-lg-block"><a class="nav-link nav-link-expand"><i class="ficon fa fa-expand"></i></a></li>
                    <li class="dropdown dropdown-notification nav-item">
                        <ul class="dropdown-menu dropdown-menu-media dropdown-menu-right">
                            <li class="scrollable-container media-list"><a class="d-flex justify-content-between" href="javascript:void(0)"></a>
                               <a class="d-flex justify-content-between" href="javascript:void(0)">
                                <div class="media d-flex align-items-start">
                                    <div class="media-left"><i class="feather icon-file font-medium-5 warning"></i>
                                    </div>

                                </div>
                            </a>
                        </li>
                    </ul>
                </li>
                <li class="dropdown dropdown-user nav-item"><a class="dropdown-toggle nav-link dropdown-user-link" href="#" data-toggle="dropdown">
                    <div class="user-nav d-sm-flex d-none"><span class="user-name text-bold-600">{{user.get_username}}</span></div><span>
                        {% if not user.perfil.image%}
                        <img class="round" src="{% static 'img/forall.png'%}" alt="avatar" height="40" width="40">
                        {% else%}
                        <img class="round" src="{{ user.perfil.image.url }}" alt="avatar" height="40" width="40">
                        {% endif %}
                        
                    </span>
                </a>
                <div class="dropdown-menu dropdown-menu-right">
                    <a class="dropdown-item" href="{% url 'videos' %}"><i class="fa fa-youtube"></i>Posta vídeo</a>
                    <a class="dropdown-item" href="{% url 'mostravideos' %}"><i class="fa fa-play"></i>Meus vídeos</a>
                    <div class="dropdown-divider"></div>
                    {% if user.is_authenticated %}
                    <a class="dropdown-item" href="/accounts/logout"><i class="fa fa-unlock"></i>Sair</a>
                    {% endif %}
                </div>
            </li>
        </ul>
    </div>
</div>
</div>
</nav>
<div class="horizontal-menu-wrapper">
    <div class="col-12">
       {% if messages %}
       <div class="alert alert-success" role="alert">
        {% for message in messages %}
        <p {% if message.tags %} class="alert alert-success{{message.tags}}" {% endif %} style="color:white;font-size: 20px;font-family: Times New Roman;text-align: center;">&nbsp;<i class="fa fa-bell-o"></i>&nbsp;{{message}}
        </p>
        {% endfor %}
    </div>
    {% endif %}
</div>
<div class="header-navbar navbar-expand-sm navbar navbar-horizontal floating-nav navbar-light navbar-without-dd-arrow navbar-shadow menu-border" role="navigation" data-menu="menu-wrapper">
    <div class="navbar-header">
        <ul class="nav navbar-nav flex-row">
            <li class="nav-item mr-auto">
                <div class="brand-logo"></div>
                <img class="" src="{% static 'img/forall.png'%}" alt="avatar" height="45" width="45">                </a></li>
                <li class="nav-item nav-toggle"><a class="nav-link modern-nav-toggle pr-0" data-toggle="collapse"><i class="fa fa-times d-block d-xl-none font-medium-4 primary toggle-icon"></i><i class="toggle-icon feather icon-disc font-medium-4 d-none d-xl-block collapse-toggle-icon primary" data-ticon="icon-disc"></i></a></li>
            </ul>
        </div>
        <!-- Horizontal menu content-->
        <div class="navbar-container main-menu-content" data-menu="menu-container">
            <!-- include ../../../includes/mixins-->
            <ul class="nav navbar-nav" id="main-menu-navigation" data-menu="menu-navigation">
                <li>
                    {% if user.is_authenticated %}
                    <a class="dropdown-item" href="/accounts/logout" style="color: white;"><i class="fa fa-unlock"></i>Sair</a>
                    {% endif %}
                </li>
                <li>
                    {% if user.is_authenticated %}
                    <a class="dropdown-item" href="{% url 'perfil' %}" style="color: white;"><i class="fa fa-user"></i>Perfil</a>
                    {% endif %}
                </li>
                <li>
                    <a class="dropdown-item" href="{% url 'criaranuncio' %}" style="color: white;"><i class="fa fa-cart-plus"></i>Criar anúncio</a>
                </li>
                <li>
                    <a class="dropdown-item" href="{% url 'videos' %}" style="color: white;"><i class="fa fa-video-camera"></i>Posta vídeo</a>
                </li>
                <li>
                    <a class="dropdown-item" href="{% url 'momentos' %}" style="color: white;"><i class="fa fa-pencil-square"></i>Criar Stories</a>
                </li>
                <li>
                    <a href="https://www.facebook.com/forall.letsgo/" target="_blank" title="Facebook" style="color:white"><i class="fa fa-facebook"></i></a>
                </li>
                <li>
                    <a href="https://www.instagram.com/forall2020_/" target="_blank" title="Instagram" style="color:white"><i class="fa fa-instagram"></i></a>
                </li>
            </ul>
        </li>
    </ul>
</div>
</div>
</div>
<div class="app-content content">
    <div class="content-overlay"></div>
    <div class="header-navbar-shadow"></div>
    <div class="content-wrapper"> 
        <div class="content-body">
            <div class="container">
                <div class="row">
                    <div class="col-sm-3 col-12">
                        <div id="users-list" class="chat-user-list list-group position-relative">
                            <ul class="chat-users-list-wrapper media-list">
                                <li style="list-style: none;">
                                    <div class="pr-1">
                                        <span class="avatar m-0 avatar-md">
                                            {% if not user.perfil.image%}
                                            <img class="round" src="{% static 'img/forall.png'%}" alt="avatar" height="40" width="40">
                                            {% else%}
                                            <img class="round" src="{{ user.perfil.image.url }}" alt="avatar" height="40" width="40">
                                            {% endif %}
                                        </span>
                                    </div>
                                    <div class="user-chat-info">
                                        <div class="contact-info">
                                            <p style="color: white;font-family: Times New Roman;font-size: 20px;">Eu</p>
                                        </div>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-sm-6 col-12">
                        <p style="font-family: Times New Roman;color: white;font-size: 25px;padding: 0;margin: 0;text-align: center;">Bate papo
                         <i class="fa fa-comments-o" style="color: white;font-size: 20px;padding: 0;margin: 0;text-align: center;"></i><br>
                     </p>
                     <p class="sala">
                       Você ainda esta sozinho na sala, compartilhe sua sala.
                   </p>
                   <form method="POST" enctype="multipart/form-data">
                    {% csrf_token %}
                    <fieldset class="form-label-group form-group position-relative has-icon-left">
                        <div class="form-control-position">
                            <i class="fa fa-comments-o"></i>
                        </div>
                        <label for="iconLabelLeft">Cole a url de sua sala aqui</label><br>
                        <button type="submit" class="btn btn-icon btn-icon rounded-circle btn-outline-success mr-1 mb-1" id="position-top-center" style="font-size: 15px;" data-toggle="tooltip" data-placement="top" title="compartilhe a sala">&nbsp;
                            <i class="fa fa-share-alt"></i>
                        </button>
                    </a>
                </form>
                <i class="fa fa-refresh" onClick="window.location.reload();" id="enviarSala" data-toggle="tooltip" data-placement="top" title="Limpe as mensagens"></i>&nbsp;
                <a href="{% url 'perfil'%}" data-toggle="tooltip" data-placement="top" title="Sair da sala">
                    <i class="fa fa-sign-in" id="enviarSala"></i>
                </a>
            </fieldset>
            <fieldset class="form-label-group">
                <textarea id="paginas-log" cols="100" rows="6" class="form-control" style="outline: none !important;
                border:1px solid white;
                box-shadow: 0 0 10px #719ECE;">
            </textarea><br>
            <input id="paginas-message-input" type="text" class="form-control" size="100" style="outline: none !important;
            border:1px solid white;
            box-shadow: 0 0 10px #719ECE;" placeholder="Sua Mensagem">
            <br>
            <input id="paginas-message-submit" class="btn btn-success" type="button" value="Enviar">&nbsp;
            <p style="color: red;">{{ room_name|json_script:"room-name" }}
                {{ request.user.username|json_script:"user_username"}}
            </p>
        </fieldset>
    </div>
    <div class="col-sm-3 col-12"></div>
</div>
</div> 
</div>
</div>
</div>
<!-- END: Content-->
<div class="sidenav-overlay"></div>
<div class="drag-target"></div>
<footer class="footer footer-static footer-light navbar-shadow">
    <p class="clearfix blue-grey lighten-2 mb-0"><span class="float-md-left d-block d-md-inline-block mt-25">&copy; 2021 ForAll.&nbsp;&nbsp;All rights reserved. Develop.Beta version 1.0</span>&nbsp;&nbsp;
        <a href="https://www.facebook.com/forall.letsgo/" target="_blank" title="Facebook" style="color:white"><i class="fa fa-facebook"></i></a>
        <a href="https://www.instagram.com/forall2020_/" target="_blank" title="Instagram" style="color:white"><i class="fa fa-instagram"></i></a>
    </p>
</footer>
<script src="{% static 'js/vendors.min.js' %}"></script>
<script src="{% static 'js/jquery.sticky.js' %}"></script>
<script src="{% static 'js/app-menu.js' %}"></script>
<script src="{% static 'js/app.js' %}"></script>
<script src="{% static 'js/components.js' %}"></script>
<script src="{% static 'js/user-profile.js'%}"></script>
<script src="{% static 'js/dashboard-analytics.min.js'%}"></script>
<script src="{% static 'js/dashboard-analytics.js'%}"></script>
<script>
    const user_username = JSON.parse(document.getElementById('user_username').textContent);
    const roomName = JSON.parse(document.getElementById('room-name').textContent);

    const chatSocket = new WebSocket(
        'ws://'
        + window.location.host
        + '/ws/paginas/'
        + roomName
        + '/'
        );

    chatSocket.onmessage = function(e) {
        const data = JSON.parse(e.data);
        document.querySelector('#paginas-log').value += (data.username +'| ' + data.message + '\n');
    };

    chatSocket.onclose = function(e) {
        console.error('Chat fechado inesperadamente!!');
    };

    document.querySelector('#paginas-message-input').focus();
    document.querySelector('#paginas-message-input').onkeyup = function(e) {
            if (e.keyCode === 13) {  // enter, return
                document.querySelector('#paginas-message-submit').click();
            }
        };

        document.querySelector('#paginas-message-submit').onclick = function(e) {
            const messageInputDom = document.querySelector('#paginas-message-input');
            const message = messageInputDom.value;
            chatSocket.send(JSON.stringify({
                'message': message,
                'username': user_username,
            }));
            messageInputDom.value = '';
        };
    </script> 
</body>
</html>